<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Fees</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        :root {
            --primary: #6a11cb;
            --primary-dark: #5a0db0;
            --secondary: #2575fc;
            --secondary-dark: #1c65e0;
            --accent: #ff4757;
            --accent-dark: #e84141;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --success: #28a745;
            --warning: #ffc107;
            --info: #17a2b8;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f5f7fa;
            margin: 0;
            padding: 0;
            color: #333;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            box-shadow: var(--box-shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .logo i {
            font-size: 1.5rem;
        }

        .user-info {
            display: flex;
            width: 100%;
            justify-content: flex-end;
        }

        .container {
            max-width: 1400px;
            margin: 1.5rem auto;
            padding: 0 1rem;
        }

        .dashboard-section {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 1.2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--light-gray);
        }

        .section-header {
            display: flex;
            flex-direction: column;
            margin-bottom: 1.2rem;
            gap: 1rem;
        }

        .section-header h2 {
            color: var(--primary);
            font-size: 1.3rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 0.6rem 1rem;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            transition: var(--transition);
            cursor: pointer;
            border: none;
            white-space: nowrap;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: white;
        }

        .btn-danger {
            background-color: var(--accent);
            color: white;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--dark);
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.7rem 1rem;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            transition: var(--transition);
            box-sizing: border-box;
            background-color: white;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(106, 17, 203, 0.1);
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.2rem;
        }

        .form-row .form-group {
            flex: 1;
            min-width: 200px;
        }

        .fees-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.2rem;
        }

        .fee-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 1rem;
            border-left: 3px solid var(--primary);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }

        .fee-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .fee-card label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            color: var(--dark);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .fee-card input {
            width: 100%;
            padding: 0.6rem;
            font-size: 0.9rem;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
        }

        .total-amount {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 1.2rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin: 1.5rem 0;
            border: 1px solid var(--light-gray);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .total-amount label {
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--dark);
        }

        .total-amount input {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary);
            border: none;
            background: transparent;
            text-align: right;
            width: 100%;
            padding: 0;
        }

        .actions {
            display: flex;
            flex-direction: row;
            gap: 0.8rem;
            margin-top: 1.5rem;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-top: 1.5rem;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th, td {
            padding: 0.8rem;
            text-align: left;
            border: 1px solid var(--light-gray);
        }

        th {
            background-color: var(--primary);
            color: white;
            font-weight: 500;
            position: sticky;
            top: 0;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f1f1f1;
        }

        .message {
            padding: 0.8rem 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.2rem;
            text-align: center;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .success {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success);
            border: 1px solid rgba(40, 167, 69, 0.3);
        }

        .error {
            background-color: rgba(255, 71, 87, 0.1);
            color: var(--accent);
            border: 1px solid rgba(255, 71, 87, 0.3);
        }

        .empty-state {
            text-align: center;
            padding: 2rem 1.5rem;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 2.5rem;
            color: #ddd;
            margin-bottom: 0.8rem;
        }

        .empty-state h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }

        .empty-state p {
            font-size: 0.9rem;
            margin: 0;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 0.5rem 0.8rem;
            font-size: 0.85rem;
            min-width: 70px;
            text-align: center;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: 0.25rem;
        }

        .badge-primary {
            background-color: var(--primary);
            color: white;
        }

        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h3 {
            margin: 0;
            color: var(--primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 0 0.75rem;
            }
            
            .dashboard-section {
                padding: 1rem;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0.8rem;
            }
            
            .form-row .form-group {
                min-width: 100%;
            }
            
            .actions {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .btn {
                width: 100%;
            }
            
            table {
                font-size: 0.85rem;
            }
            
            th, td {
                padding: 0.6rem;
            }

            .fees-grid {
                grid-template-columns: repeat(auto-fill, minmax(100%, 1fr));
            }

            .total-amount input {
                font-size: 1.2rem;
            }
        }

        @media (min-width: 992px) {
            .header {
                padding: 1rem 2rem;
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }

            .logo {
                margin-bottom: 0;
                font-size: 1.5rem;
            }

            .logo i {
                font-size: 1.8rem;
            }

            .user-info {
                width: auto;
            }

            .container {
                margin: 2rem auto;
                padding: 0 1.5rem;
            }

            .dashboard-section {
                padding: 1.5rem;
            }

            .section-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }

            .section-header h2 {
                font-size: 1.5rem;
            }

            .total-amount {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }

            .total-amount input {
                width: auto;
                max-width: 300px;
                text-align: right;
            }
        }

        /* Hover effects for devices that support hover */
        @media (hover: hover) {
            .btn-primary:hover {
                background-color: var(--primary-dark);
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(106, 17, 203, 0.2);
            }

            .btn-secondary:hover {
                background-color: var(--secondary-dark);
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(37, 117, 252, 0.2);
            }

            .btn-danger:hover {
                background-color: var(--accent-dark);
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(255, 71, 87, 0.2);
            }
            
            .btn-outline:hover {
                background-color: var(--primary);
                color: white;
            }
        }

        /* Extra small devices (phones, 480px and down) */
        @media (max-width: 480px) {
            .logo {
                font-size: 1.1rem;
            }
            
            .logo i {
                font-size: 1.3rem;
            }
            
            .section-header h2 {
                font-size: 1.1rem;
            }
            
            .fee-card label {
                font-size: 0.85rem;
            }
            
            .fee-card input {
                font-size: 0.85rem;
                padding: 0.5rem;
            }
            
            .total-amount label {
                font-size: 0.9rem;
            }
            
            .total-amount input {
                font-size: 1.1rem;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 0.3rem;
            }
            
            .action-btn {
                width: 100%;
                padding: 0.4rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <i class="fas fa-money-bill-wave"></i>
            <span>Manage Fees</span>
        </div>
        <div class="user-info">
            <a href="/admin/dashboard" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </a>
        </div>
    </header>

    <div class="container">
        <!-- Add Fees Form -->
        <div class="dashboard-section">
            <div class="section-header">
                <h2><i class="fas fa-plus-circle"></i> Add New Fees Structure</h2>
            </div>
            
            <!-- Success/Error Messages -->
            <div th:if="${error}" class="message error">
                <i class="fas fa-exclamation-circle"></i>
                <span th:text="${error}"></span>
            </div>
            <div th:if="${message}" class="message success">
                <i class="fas fa-check-circle"></i>
                <span th:text="${message}"></span>
            </div>
            
            <form id="addFeesForm" th:action="@{/admin/addfees}" method="post">
                <div class="form-row">
                    <div class="form-group">
                        <label for="courseId"><i class="fas fa-book"></i> Course:</label>
                        <select id="courseId" name="courseId" required onchange="loadClasses()">
                            <option value="">-- Select Course --</option>
                            <option th:each="course : ${courses}" th:value="${course.id}" th:text="${course.courseName}"></option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="classId"><i class="fas fa-users"></i> Class:</label>
                        <select id="classId" name="classId" required>
                            <option value="">-- Select Class --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="casteId"><i class="fas fa-tag"></i> Category:</label>
                        <select id="casteId" name="casteId" required>
                            <option value="">-- Select Category --</option>
                            <option th:each="caste : ${castes}" th:value="${caste.id}" th:text="${caste.casteName}"></option>
                        </select>
                    </div>
                </div>

                <!-- Fees Grid -->
                <div class="fees-grid">
                    <div class="fee-card">
                        <label for="tuitionFees"><i class="fas fa-dollar-sign"></i> Tuition Fees:</label>
                        <input type="number" step="0.01" id="tuitionFees" name="tuitionFees" required oninput="calculateTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="libraryFees"><i class="fas fa-book-open"></i> Library Fees:</label>
                        <input type="number" step="0.01" id="libraryFees" name="libraryFees" required oninput="calculateTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="gymkhanaFees"><i class="fas fa-dumbbell"></i> Gymkhana Fees:</label>
                        <input type="number" step="0.01" id="gymkhanaFees" name="gymkhanaFees" required oninput="calculateTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="laboratoryFees"><i class="fas fa-flask"></i> Laboratory Fees:</label>
                        <input type="number" step="0.01" id="laboratoryFees" name="laboratoryFees" required oninput="calculateTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="adminProcessingFees"><i class="fas fa-cogs"></i> Admin Processing Fees:</label>
                        <input type="number" step="0.01" id="adminProcessingFees" name="adminProcessingFees" required oninput="calculateTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="studentWelfareFund"><i class="fas fa-hand-holding-heart"></i> Student Welfare Fund:</label>
                        <input type="number" step="0.01" id="studentWelfareFund" name="studentWelfareFund" required oninput="calculateTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="utilityFees"><i class="fas fa-tools"></i> Utility Fees:</label>
                        <input type="number" step="0.01" id="utilityFees" name="utilityFees" required oninput="calculateTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="idLibCardFees"><i class="fas fa-id-card"></i> ID & Library Card Fees:</label>
                        <input type="number" step="0.01" id="idLibCardFees" name="idLibCardFees" required oninput="calculateTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="eCharges"><i class="fas fa-bolt"></i> E-Charges:</label>
                        <input type="number" step="0.01" id="eCharges" name="eCharges" required oninput="calculateTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="vcFund"><i class="fas fa-hand-holding-usd"></i> V.C. Fund:</label>
                        <input type="number" step="0.01" id="vcFund" name="vcFund" required oninput="calculateTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="nssFees"><i class="fas fa-users-cog"></i> NSS Fees:</label>
                        <input type="number" step="0.01" id="nssFees" name="nssFees" required oninput="calculateTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="sportsFees"><i class="fas fa-running"></i> Sports Fees:</label>
                        <input type="number" step="0.01" id="sportsFees" name="sportsFees" required oninput="calculateTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="collegeCulFees"><i class="fas fa-theater-masks"></i> College Cultural Fees:</label>
                        <input type="number" step="0.01" id="collegeCulFees" name="collegeCulFees" required oninput="calculateTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="otherFees"><i class="fas fa-coins"></i> Other Fees:</label>
                        <input type="number" step="0.01" id="otherFees" name="otherFees" required oninput="calculateTotal()" placeholder="0.00">
                    </div>
                </div>

                <!-- Total Amount -->
                <div class="total-amount">
                    <label for="totalAmount"><i class="fas fa-calculator"></i> Total Amount:</label>
                    <input type="text" id="totalAmount" name="totalAmount" readonly value="0.00">
                </div>

                <!-- Actions -->
                <div class="actions">
                    <button type="reset" class="btn btn-outline">
                        <i class="fas fa-undo"></i> Reset
                    </button>
                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        <i class="fas fa-save"></i> Save Fees
                    </button>
                </div>
            </form>
        </div>

        <!-- Fees List -->
        <div class="dashboard-section">
            <div class="section-header">
                <h2><i class="fas fa-list"></i> Fees List</h2>
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="refreshFeesList()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Course</th>
                            <th>Class</th>
                            <th>Category</th>
                            <th>Total Amount</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="feesTableBody">
                        <!-- Empty State -->
                        <tr th:if="${feesList == null or feesList.isEmpty()}">
                            <td colspan="6">
                                <div class="empty-state">
                                    <i class="fas fa-money-bill-wave"></i>
                                    <h3>No fees structures found</h3>
                                    <p>Add your first fees structure using the form above</p>
                                </div>
                            </td>
                        </tr>
                        
                        <!-- Fees List -->
                        <tr th:each="fees : ${feesList}" th:unless="${feesList == null or feesList.isEmpty()}">
                            <td th:text="${fees.id}"></td>
                            <td th:text="${fees.course.courseName}"></td>
                            <td th:text="${fees.classEntity.className}"></td>
                            <td>
                                <span class="badge badge-primary" th:text="${fees.caste.casteName}"></span>
                            </td>
                            <td>
                                ₹<span th:text="${#numbers.formatDecimal(fees.tuitionFees + fees.libraryFees + fees.gymkhanaFees + fees.laboratoryFees + fees.adminProcessingFees + fees.studentWelfareFund + fees.utilityFees + fees.idLibCardFees + fees.eCharges + fees.vcFund + fees.nssFees + fees.sportsFees + fees.collegeCulFees + fees.otherFees, 1, 2)}"></span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn btn-secondary action-btn" th:onclick="'openEditModal(' + ${fees.id} + ')'">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="btn btn-danger action-btn" th:onclick="'confirmDelete(' + ${fees.id} + ')'">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Edit Fees Structure</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <form id="editFeesForm">
                <input type="hidden" id="editFeesId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="editCourseId"><i class="fas fa-book"></i> Course:</label>
                        <select id="editCourseId" name="courseId" required>
                            <option value="">-- Select Course --</option>
                            <option th:each="course : ${courses}" th:value="${course.id}" th:text="${course.courseName}"></option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editClassId"><i class="fas fa-users"></i> Class:</label>
                        <select id="editClassId" name="classId" required>
                            <option value="">-- Select Class --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editCasteId"><i class="fas fa-tag"></i> Category:</label>
                        <select id="editCasteId" name="casteId" required>
                            <option value="">-- Select Category --</option>
                            <option th:each="caste : ${castes}" th:value="${caste.id}" th:text="${caste.casteName}"></option>
                        </select>
                    </div>
                </div>
                
                <div class="fees-grid">
                    <div class="fee-card">
                        <label for="editTuitionFees"><i class="fas fa-dollar-sign"></i> Tuition Fees:</label>
                        <input type="number" step="0.01" id="editTuitionFees" name="tuitionFees" required oninput="calculateEditTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="editLibraryFees"><i class="fas fa-book-open"></i> Library Fees:</label>
                        <input type="number" step="0.01" id="editLibraryFees" name="libraryFees" required oninput="calculateEditTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="editGymkhanaFees"><i class="fas fa-dumbbell"></i> Gymkhana Fees:</label>
                        <input type="number" step="0.01" id="editGymkhanaFees" name="gymkhanaFees" required oninput="calculateEditTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="editLaboratoryFees"><i class="fas fa-flask"></i> Laboratory Fees:</label>
                        <input type="number" step="0.01" id="editLaboratoryFees" name="laboratoryFees" required oninput="calculateEditTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="editAdminProcessingFees"><i class="fas fa-cogs"></i> Admin Processing Fees:</label>
                        <input type="number" step="0.01" id="editAdminProcessingFees" name="adminProcessingFees" required oninput="calculateEditTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="editStudentWelfareFund"><i class="fas fa-hand-holding-heart"></i> Student Welfare Fund:</label>
                        <input type="number" step="0.01" id="editStudentWelfareFund" name="studentWelfareFund" required oninput="calculateEditTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="editUtilityFees"><i class="fas fa-tools"></i> Utility Fees:</label>
                        <input type="number" step="0.01" id="editUtilityFees" name="utilityFees" required oninput="calculateEditTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="editIdLibCardFees"><i class="fas fa-id-card"></i> ID & Library Card Fees:</label>
                        <input type="number" step="0.01" id="editIdLibCardFees" name="idLibCardFees" required oninput="calculateEditTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="editECharges"><i class="fas fa-bolt"></i> E-Charges:</label>
                        <input type="number" step="0.01" id="editECharges" name="eCharges" required oninput="calculateEditTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="editVcFund"><i class="fas fa-hand-holding-usd"></i> V.C. Fund:</label>
                        <input type="number" step="0.01" id="editVcFund" name="vcFund" required oninput="calculateEditTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="editNssFees"><i class="fas fa-users-cog"></i> NSS Fees:</label>
                        <input type="number" step="0.01" id="editNssFees" name="nssFees" required oninput="calculateEditTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="editSportsFees"><i class="fas fa-running"></i> Sports Fees:</label>
                        <input type="number" step="0.01" id="editSportsFees" name="sportsFees" required oninput="calculateEditTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="editCollegeCulFees"><i class="fas fa-theater-masks"></i> College Cultural Fees:</label>
                        <input type="number" step="0.01" id="editCollegeCulFees" name="collegeCulFees" required oninput="calculateEditTotal()" placeholder="0.00">
                    </div>
                    <div class="fee-card">
                        <label for="editOtherFees"><i class="fas fa-coins"></i> Other Fees:</label>
                        <input type="number" step="0.01" id="editOtherFees" name="otherFees" required oninput="calculateEditTotal()" placeholder="0.00">
                    </div>
                </div>
                
                <div class="total-amount">
                    <label for="editTotalAmount"><i class="fas fa-calculator"></i> Total Amount:</label>
                    <input type="text" id="editTotalAmount" name="totalAmount" readonly value="0.00">
                </div>
                
                <div class="actions">
                    <button type="button" class="btn btn-outline" onclick="closeModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="updateBtn" onclick="updateFees()">
                        <i class="fas fa-save"></i> Update Fees
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> Confirm Delete</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div style="padding: 1.5rem;">
                <p>Are you sure you want to delete this fees structure? This action cannot be undone.</p>
                <input type="hidden" id="deleteFeesId">
                <div class="actions">
                    <button type="button" class="btn btn-outline" onclick="closeModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="button" class="btn btn-danger" id="deleteBtn" onclick="deleteFees()">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Function to load classes based on the selected course
        function loadClasses() {
            const courseId = document.getElementById("courseId").value;
            const classDropdown = document.getElementById("classId");

            // Clear existing options
            classDropdown.innerHTML = '<option value="">-- Select Class --</option>';

            if (courseId) {
                // Show loading state
                const defaultOption = document.createElement("option");
                defaultOption.value = "";
                defaultOption.text = "Loading classes...";
                defaultOption.disabled = true;
                defaultOption.selected = true;
                classDropdown.appendChild(defaultOption);
                
                // Fetch classes for the selected course
                $.ajax({
                    url: "/admin/classes",
                    type: "GET",
                    data: { courseId: courseId },
                    success: function (data) {
                        // Clear loading state
                        classDropdown.innerHTML = '<option value="">-- Select Class --</option>';
                        
                        // Populate the class dropdown
                        if (data.length > 0) {
                            data.forEach(function (classEntity) {
                                const option = document.createElement("option");
                                option.value = classEntity.id;
                                option.text = classEntity.className;
                                classDropdown.appendChild(option);
                            });
                        } else {
                            const option = document.createElement("option");
                            option.value = "";
                            option.text = "No classes found";
                            option.disabled = true;
                            classDropdown.appendChild(option);
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error("Failed to load classes:", error);
                        classDropdown.innerHTML = '<option value="">-- Select Class --</option>';
                        showAlert("Failed to load classes. Please try again.", "error");
                    }
                });
            }
        }

        // Function to calculate the total amount
        function calculateTotal() {
            const tuitionFees = parseFloat(document.getElementById("tuitionFees").value) || 0;
            const libraryFees = parseFloat(document.getElementById("libraryFees").value) || 0;
            const gymkhanaFees = parseFloat(document.getElementById("gymkhanaFees").value) || 0;
            const laboratoryFees = parseFloat(document.getElementById("laboratoryFees").value) || 0;
            const adminProcessingFees = parseFloat(document.getElementById("adminProcessingFees").value) || 0;
            const studentWelfareFund = parseFloat(document.getElementById("studentWelfareFund").value) || 0;
            const utilityFees = parseFloat(document.getElementById("utilityFees").value) || 0;
            const idLibCardFees = parseFloat(document.getElementById("idLibCardFees").value) || 0;
            const eCharges = parseFloat(document.getElementById("eCharges").value) || 0;
            const vcFund = parseFloat(document.getElementById("vcFund").value) || 0;
            const nssFees = parseFloat(document.getElementById("nssFees").value) || 0;
            const sportsFees = parseFloat(document.getElementById("sportsFees").value) || 0;
            const collegeCulFees = parseFloat(document.getElementById("collegeCulFees").value) || 0;
            const otherFees = parseFloat(document.getElementById("otherFees").value) || 0;

            const totalAmount = tuitionFees + libraryFees + gymkhanaFees + laboratoryFees + 
                              adminProcessingFees + studentWelfareFund + utilityFees + 
                              idLibCardFees + eCharges + vcFund + nssFees + sportsFees + 
                              collegeCulFees + otherFees;
            document.getElementById("totalAmount").value = totalAmount.toFixed(2);
        }

        // Function to show alert message
        function showAlert(message, type) {
            const alertDiv = document.createElement("div");
            alertDiv.className = `message ${type}`;
            alertDiv.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            
            const container = document.querySelector(".container");
            container.insertBefore(alertDiv, container.firstChild);
            
            // Remove alert after 5 seconds
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // Function to open the edit modal
        function openEditModal(id) {
            // Show loading state
            const modal = document.getElementById("editModal");
            modal.style.display = "flex";
            document.body.style.overflow = "hidden";
            
            // Fetch fees data for the given ID
            $.ajax({
                url: "/admin/fees/" + id,
                type: "GET",
                beforeSend: function() {
                    // Show loading state in modal
                },
                success: function (data) {
                    // Populate the edit form with fetched data
                    document.getElementById("editFeesId").value = data.id;
                    document.getElementById("editCourseId").value = data.course.id;
                    
                    // Load classes for the selected course
                    const classDropdown = document.getElementById("editClassId");
                    classDropdown.innerHTML = '<option value="">-- Select Class --</option>';
                    const option = document.createElement("option");
                    option.value = data.classEntity.id;
                    option.text = data.classEntity.className;
                    option.selected = true;
                    classDropdown.appendChild(option);
                    
                    document.getElementById("editCasteId").value = data.caste.id;
                    document.getElementById("editTuitionFees").value = data.tuitionFees.toFixed(2);
                    document.getElementById("editLibraryFees").value = data.libraryFees.toFixed(2);
                    document.getElementById("editGymkhanaFees").value = data.gymkhanaFees.toFixed(2);
                    document.getElementById("editLaboratoryFees").value = data.laboratoryFees.toFixed(2);
                    document.getElementById("editAdminProcessingFees").value = data.adminProcessingFees.toFixed(2);
                    document.getElementById("editStudentWelfareFund").value = data.studentWelfareFund.toFixed(2);
                    document.getElementById("editUtilityFees").value = data.utilityFees.toFixed(2);
                    document.getElementById("editIdLibCardFees").value = data.idLibCardFees.toFixed(2);
                    document.getElementById("editECharges").value = data.eCharges.toFixed(2);
                    document.getElementById("editVcFund").value = data.vcFund.toFixed(2);
                    document.getElementById("editNssFees").value = data.nssFees.toFixed(2);
                    document.getElementById("editSportsFees").value = data.sportsFees.toFixed(2);
                    document.getElementById("editCollegeCulFees").value = data.collegeCulFees.toFixed(2);
                    document.getElementById("editOtherFees").value = data.otherFees.toFixed(2);
                    
                    // Calculate and set total
                    calculateEditTotal();
                },
                error: function (xhr, status, error) {
                    console.error("Failed to fetch fees data:", error);
                    closeModal();
                    showAlert("Failed to fetch fees data. Please try again.", "error");
                }
            });
        }

        // Function to calculate total for edit form
        function calculateEditTotal() {
            const tuitionFees = parseFloat(document.getElementById("editTuitionFees").value) || 0;
            const libraryFees = parseFloat(document.getElementById("editLibraryFees").value) || 0;
            const gymkhanaFees = parseFloat(document.getElementById("editGymkhanaFees").value) || 0;
            const laboratoryFees = parseFloat(document.getElementById("editLaboratoryFees").value) || 0;
            const adminProcessingFees = parseFloat(document.getElementById("editAdminProcessingFees").value) || 0;
            const studentWelfareFund = parseFloat(document.getElementById("editStudentWelfareFund").value) || 0;
            const utilityFees = parseFloat(document.getElementById("editUtilityFees").value) || 0;
            const idLibCardFees = parseFloat(document.getElementById("editIdLibCardFees").value) || 0;
            const eCharges = parseFloat(document.getElementById("editECharges").value) || 0;
            const vcFund = parseFloat(document.getElementById("editVcFund").value) || 0;
            const nssFees = parseFloat(document.getElementById("editNssFees").value) || 0;
            const sportsFees = parseFloat(document.getElementById("editSportsFees").value) || 0;
            const collegeCulFees = parseFloat(document.getElementById("editCollegeCulFees").value) || 0;
            const otherFees = parseFloat(document.getElementById("editOtherFees").value) || 0;

            const totalAmount = tuitionFees + libraryFees + gymkhanaFees + laboratoryFees + 
                              adminProcessingFees + studentWelfareFund + utilityFees + 
                              idLibCardFees + eCharges + vcFund + nssFees + sportsFees + 
                              collegeCulFees + otherFees;
            document.getElementById("editTotalAmount").value = totalAmount.toFixed(2);
        }

        // Function to update fees
        function updateFees() {
            const id = document.getElementById("editFeesId").value;
            const formData = {
                courseId: document.getElementById("editCourseId").value,
                classId: document.getElementById("editClassId").value,
                casteId: document.getElementById("editCasteId").value,
                tuitionFees: parseFloat(document.getElementById("editTuitionFees").value) || 0,
                libraryFees: parseFloat(document.getElementById("editLibraryFees").value) || 0,
                gymkhanaFees: parseFloat(document.getElementById("editGymkhanaFees").value) || 0,
                laboratoryFees: parseFloat(document.getElementById("editLaboratoryFees").value) || 0,
                adminProcessingFees: parseFloat(document.getElementById("editAdminProcessingFees").value) || 0,
                studentWelfareFund: parseFloat(document.getElementById("editStudentWelfareFund").value) || 0,
                utilityFees: parseFloat(document.getElementById("editUtilityFees").value) || 0,
                idLibCardFees: parseFloat(document.getElementById("editIdLibCardFees").value) || 0,
                eCharges: parseFloat(document.getElementById("editECharges").value) || 0,
                vcFund: parseFloat(document.getElementById("editVcFund").value) || 0,
                nssFees: parseFloat(document.getElementById("editNssFees").value) || 0,
                sportsFees: parseFloat(document.getElementById("editSportsFees").value) || 0,
                collegeCulFees: parseFloat(document.getElementById("editCollegeCulFees").value) || 0,
                otherFees: parseFloat(document.getElementById("editOtherFees").value) || 0
            };
            
            // Show loading state on button
            const btn = document.getElementById("updateBtn");
            btn.innerHTML = '<span class="spinner"></span> Updating...';
            btn.disabled = true;
            
            $.ajax({
                url: "/admin/updatefees/" + id,
                type: "PUT",
                data: JSON.stringify(formData),
                contentType: "application/json",
                success: function (response) {
                    closeModal();
                    showAlert("Fees structure updated successfully!", "success");
                    refreshFeesList();
                },
                error: function (xhr, status, error) {
                    console.error("Failed to update fees:", error);
                    btn.innerHTML = '<i class="fas fa-save"></i> Update Fees';
                    btn.disabled = false;
                    showAlert("Failed to update fees structure. Please try again.", "error");
                }
            });
        }

        // Function to confirm delete
        function confirmDelete(id) {
            document.getElementById("deleteFeesId").value = id;
            const modal = document.getElementById("deleteModal");
            modal.style.display = "flex";
            document.body.style.overflow = "hidden";
        }

        // Function to delete fees
        function deleteFees() {
            const id = document.getElementById("deleteFeesId").value;
            
            // Show loading state on button
            const btn = document.getElementById("deleteBtn");
            btn.innerHTML = '<span class="spinner"></span> Deleting...';
            btn.disabled = true;
            
            $.ajax({
                url: "/admin/deletefees/" + id,
                type: "DELETE",
                success: function (response) {
                    closeModal();
                    showAlert("Fees structure deleted successfully!", "success");
                    refreshFeesList();
                },
                error: function (xhr, status, error) {
                    console.error("Failed to delete fees:", error);
                    btn.innerHTML = '<i class="fas fa-trash"></i> Delete';
                    btn.disabled = false;
                    showAlert("Failed to delete fees structure. Please try again.", "error");
                }
            });
        }

        // Function to refresh fees list
        function refreshFeesList() {
            $.ajax({
                url: "/admin/feeslist",
                type: "GET",
                success: function (data) {
                    // Update the table with new data
                    const tbody = document.getElementById("feesTableBody");
                    tbody.innerHTML = data;
                },
                error: function (xhr, status, error) {
                    console.error("Failed to refresh fees list:", error);
                    showAlert("Failed to refresh fees list. Please try again.", "error");
                }
            });
        }

        // Function to close modal
        function closeModal() {
            document.getElementById("editModal").style.display = "none";
            document.getElementById("deleteModal").style.display = "none";
            document.body.style.overflow = "auto";
        }

        // Initialize form validation
        document.getElementById("addFeesForm").addEventListener("submit", function(e) {
            const submitBtn = document.getElementById("submitBtn");
            submitBtn.innerHTML = '<span class="spinner"></span> Saving...';
            submitBtn.disabled = true;
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const editModal = document.getElementById("editModal");
            const deleteModal = document.getElementById("deleteModal");
            
            if (event.target === editModal) {
                closeModal();
            }
            if (event.target === deleteModal) {
                closeModal();
            }
        };

        // Initialize the page
        document.addEventListener("DOMContentLoaded", function() {
            // Any initialization code can go here
        });
    </script>
</body>
</html>